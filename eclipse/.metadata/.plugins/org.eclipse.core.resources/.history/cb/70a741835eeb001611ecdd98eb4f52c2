package escapemc.Gui.TabGui;

import java.util.ArrayList;

import org.lwjgl.input.Keyboard;

import cf.euphoria.Utopia.Utopia;
import cf.euphoria.Utopia.eventapi.EventSys;
import cf.euphoria.Utopia.eventapi.events.EventKeyboard;
import cf.euphoria.Utopia.eventapi.events.EventRender2D;
import cf.euphoria.Utopia.mod.Mod;
import escapemc.Event.Event;
import escapemc.module.Category;
import net.minecraft.client.Minecraft;
import net.minecraft.client.gui.Gui;

public class CtrlMCTabGui {

	private Section sec = Section.CATS;
	private int maxCat, maxMod, currCat, currMod;
	private Category currC;

	public CtrlMCTabGui() {
		EventSys.reg(this);
	}

	public void init() {
		for (Category cat : Cat.values()) {
			if (Minecraft.getMinecraft().fontRendererObj.getStringWidth(cat.name()) > maxCat) {
				maxCat = Minecraft.getMinecraft().fontRendererObj.getStringWidth(cat.name());
			}
		}
		maxCat += 6;
		for (Mod m : Utopia.getUtopia().mods.getMods()) {
			if (Minecraft.getMinecraft().fontRendererObj.getStringWidth(m.getName()) > maxMod) {
				maxMod = Minecraft.getMinecraft().fontRendererObj.getStringWidth(m.getName());
			}
		}
		maxMod += 6;
	}

	@Override
	public void onEvent(Event event) {
		if (!Minecraft.getMinecraft().gameSettings.showDebugInfo) {
			if (event.getClass() == EventRender2D.class) {
				int yC = 24;
				currC = Cat.values()[0];
				for (int i = 0; i < Cat.values().length; i++) {
					Gui.drawRect(2, yC, maxCat, (yC + Minecraft.getMinecraft().fontRendererObj.FONT_HEIGHT + 2),
							Integer.MIN_VALUE);
					Gui.drawRect(2, yC, maxCat, (yC + Minecraft.getMinecraft().fontRendererObj.FONT_HEIGHT + 2),
							(i == currCat) ? Integer.MIN_VALUE : 1);
					Minecraft.getMinecraft().fontRendererObj.drawStringWithShadow(Cat.values()[i].name(), 4, yC + 2,
							-1);
					currC = Cat.values()[currCat];
					yC += 12;
				}
				int yCM = 24;
				if (sec == Section.MODS) {
					for (int i = 0; i < this.getModsInCat(currC).size(); i++) {
						Gui.drawRect(maxCat + 2, yCM, maxCat + maxMod,
								(yCM + Minecraft.getMinecraft().fontRendererObj.FONT_HEIGHT + 2), Integer.MIN_VALUE);
						Gui.drawRect(maxCat + 2, yCM, maxCat + maxMod,
								(yCM + Minecraft.getMinecraft().fontRendererObj.FONT_HEIGHT + 2),
								(i == currMod) ? Integer.MIN_VALUE : 1);
						Minecraft.getMinecraft().fontRendererObj.drawStringWithShadow(
								this.getModsInCat(currC).get(i).getName(), maxCat + 4, yCM + 2,
								this.getModsInCat(currC).get(i).isEnabled() ? 0x888888 : -1);
						yCM += 12;
					}
				}
			}
			if (event.getClass() == EventKeyboard.class) {
				switch (((EventKeyboard) event).getKey()) {
				case Keyboard.KEY_DOWN:
					if (this.sec == Section.CATS) {
						if (this.currCat < Cat.values().length - 1) {
							this.currCat++;
						} else {
							this.currCat = 0;
						}
					}
					if (this.sec == Section.MODS) {
						if (this.currMod < this.getModsInCat(currC).size() - 1) {
							this.currMod++;
						} else {
							this.currMod = 0;
						}
					}
					break;
				case Keyboard.KEY_UP:
					if (this.sec == Section.CATS) {
						if (this.currCat > 0) {
							this.currCat--;
						} else {
							this.currCat = Cat.values().length - 1;
						}
					}
					if (this.sec == Section.MODS) {
						if (this.currMod > 0) {
							this.currMod--;
						} else {
							this.currMod = this.getModsInCat(currC).size() - 1;
						}
					}
					break;
				case Keyboard.KEY_LEFT:
					if (sec == Section.MODS) {
						sec = Section.CATS;
					}
					break;
				case Keyboard.KEY_RIGHT:
					if (sec == Section.MODS) {
						Mod m = this.getModsInCat(currC).get(currMod);
						if (m != null) {
							m.toggle();
						}
					}
					if (sec == Section.CATS) {
						sec = Section.MODS;
						this.currMod = 0;
					}
					break;
				}
			}
		}
	}

	public ArrayList<Mod> getModsInCat(Cat cat) {
		ArrayList<Mod> arr = new ArrayList<Mod>();
		for (Mod m : Utopia.getUtopia().mods.getMods()) {
			if (m.getCat() == cat) {
				arr.add(m);
			}
		}
		return arr;
	}

	private enum Section {
		CATS, MODS;
	}

}